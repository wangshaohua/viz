<!DOCTYPE html>
<meta charset="utf-8">
  <style>

  .land { fill: #333; stroke: #333;}

  .g-0 { fill: #218559; }
  .g-1 { fill: #06A2CB; }
  .g-2 { fill: #EBB035; }
  .g-3 { fill: #DD1E2F; }
  .g-4 { fill: #D0C6B1;}

  </style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="js/underscore-min.js"></script>

<h1>The cities' fingerprints</h1>

<p>Click on any of the cities to see their fingerprint. Black map on a white background. Moves away when we click on one of the cities, replaced by citie's fragments and plots.</p>

<div id="map"></div>

</body>





<script>

function parseData(d) {
   // We parse data and convert floats to floats (except the names obviously)
  var keys = _.keys(d[0]);
  return _.map(d, function(d) {
    var o = {};
    _.each(keys, function(k) {
      if( k == 'City' )
        o[k] = d[k];
      else if( k == 'Group')
         o[k] = parseInt(d[k]);
      else
        o[k] = parseFloat(d[k]);
    });
    return o;
  });
}

var width = 2000,
    height = 1700;

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var projection = d3.geo.mercator()
    .scale(300)
    .translate([width/2,height/1.5]);

var path = d3.geo.path()
    .projection(projection);

d3.csv("data/cities.csv", function(data) {

   var data = parseData(data);
   console.log(data);

  d3.json("data/world_map/world.json", function(error, world) {

    // Plot the world map
    svg.selectAll("path")
      .data(world.features)
        .enter().append("path")
          .attr("class","land")
          .attr("d", path);

    svg.selectAll("circle")
      .data(data)
        .enter().append("circle")  
          .attr("class", function(d) { return "g-" + d.Group; } )
          .attr("cx", function(d) { return projection([d.Longitude,d.Latitude])[0]; })
          .attr("cy", function(d) { return projection([d.Longitude,d.Latitude])[1]; })
          .attr("r",8);    

    svg.selectAll("path")
      .data(data)
        .enter().append("path")
          .attr("class","city")
          .attr("transform", function(d) { return "translate(" + x(d.Longitude) + "," + y(d.Latitude) + ")"; })
          .attr("transform", function(d) { return "scale(100)"; })
          .attr("d", d3.svg.symbol());        


  });
});


</script>